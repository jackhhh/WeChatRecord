function getCookie(a){var e=null;if(document.cookie&&""!=document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var o=jQuery.trim(t[n]);if(o.substring(0,a.length+1)==a+"="){e=decodeURIComponent(o.substring(a.length+1));break}}return e}function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function displayContent(a,e,t,n){var o;"undefined"==typeof t&&(t="#main-page"),o=$(t);var i=!0,s=!0;if("undefined"!=typeof e)for(var r in e)"anim"===r&&(i=e.anim),"scroll"===r&&(s=e.scroll);i&&o.css("opacity")>0?o.animate({opacity:0},250):o.css("opacity",0),o.queue(function(){o.html(a);var e=function(){o.css({height:"auto",opacity:1}),"function"==typeof n&&n()};if(i){var r=0;if(o.children().each(function(){var a=$(this);"script"!==a.prop("tagName").toLowerCase()&&"none"!==a.css("display")&&(r+=a.outerHeight(!0))}),r=Math.max(r,removePx(o.css("min-height"))),s){var l=$(".main").css("padding-top"),c=parseInt(l.substr(0,l.indexOf("px")),10),d=o.position().top+("#main-page"===t?-c:c);$("html, body").stop(!0).delay(50).animate({"scroll-top":d})}o.delay(50).animate({opacity:1,height:r},e)}else e();$(this).dequeue()})}function loadContent(a,e,t,n,o){var i=$("#main-page"),s=!1,r=!0;if("undefined"!=typeof n&&(n.hasOwnProperty("replace")&&(s=n.replace),n.hasOwnProperty("anim")&&(r=n.anim)),i.stop(!0),r?i.animate({opacity:0,height:i.height()},250):i.css("height",i.height()),$(".left-column-item").removeClass("active"),"undefined"!=typeof t){var l=$(t);"undefined"!=typeof l&&$(l).addClass("active")}var c;c=setTimeout(function(){i.animate({opacity:50,height:100},250),i.html('            <div style="width: 100%; text-align: center;">                <span class="fa fa-spinner fa-pulse fa-4x"></span>            </div>')},1e3),$.ajax({type:"GET",url:a,data:e,success:function(e){clearTimeout(c),__manualStateChange=!0;var i={data:e,params:n,item:t,rand:Math.random(),callback:o};s?History.replaceState(i,document.title,a):History.pushState(i,document.title,a),initAjaxPage("#main-page"),loadComplete()},error:function(a,e,t){clearTimeout(c),displayContent('                <div class="alert alert-danger" role="alert">                    <strong>页面载入出错。</strong>                    错误信息：'+e+": "+a.status+" "+t+a.responseText.replace(/\n/g,"<br>")+"</div>")}})}function initAjaxPage(a){$(a).ready(function(){$(".ajax-link").unbind().click(function(){loadContent($(this).data("url"))})})}function loadContentOn(a,e,t,n,o){$(".main").css("height","auto");var i=a,s=!1;for(var r in n)"anim"===r&&(s=n.anim);s===!0&&i.animate({opacity:0,height:0},250);var l;l=setTimeout(function(){i.animate({opacity:30,height:100},250),i.html("TBODY"==i.prop("tagName")?'                <tr style="background-color: white;"><td colspan="10000">                    <p></p>                    <p style="text-align: center">                        <span class="fa fa-spinner fa-pulse fa-2x"></span>                    </p>                </td></tr>':'                <div style="width: 100%; text-align: center;">                    <span class="fa fa-spinner fa-pulse fa-3x"></span>                </div>')},1e3),$.ajax({type:"GET",url:e,data:t,success:function(e){clearTimeout(l),displayContent(e,n,a,function(){"function"==typeof o&&o(),initAjaxPage(a),loadComplete()})},error:function(e,t,n){clearTimeout(l),displayContent('                <div class="alert alert-danger" role="alert">                    <strong>部件载入出错。</strong>                    错误信息：'+t+": "+e.status+" "+n+e.responseText.replace(/\n/g,"<br>")+"</div>",{anim:!0,scroll:!0},a)}})}function loadContentOfItem(a,e,t){loadContent($(a).data("url"),{},a,e,t)}function removePx(a){return"number"==typeof a?a:parseInt(a.substr(0,a.length-2))}function handleFormPost(a,e,t){var n=$(a);n.ready(function(){var a=n.find(".form-error-msg"),o=a.find("> div"),i=n.find(".form-group"),s=n.find(".form-method");n.find(".form-btn").click(function(){s.attr("value",$(this).attr("value"))}),i.not(i.has("span.help-block.with-errors")).append('<span class="help-block with-errors"></span>');var r=function(a){return"ok"===a.status?"#no_message#":a.hasOwnProperty("error_message")?a.error_message:"提交出错，请再次检查您填写的信息。"},l=$.noop,c=$.noop,d=r,u=$.noop;t.hasOwnProperty("success_callback")&&(l=t.success_callback),t.hasOwnProperty("error_callback")&&(c=t.error_callback),t.hasOwnProperty("success_msg")&&(d=t.success_msg),t.hasOwnProperty("before_submit")&&(u=t.before_submit),i.find("input, textarea").focus(function(){$(this).parent().removeClass("has-error"),a.fadeOut()}),n.submit(function(t){u(t),t.preventDefault(),i.removeClass("has-error"),$.ajax({type:"POST",url:e,data:n.serialize(),success:function(e){a.removeClass("alert-danger alert-success"),a.addClass("ok"===e.status?"alert-success":"alert-danger");var t=d(e);if(""===t&&(t=r),""!==t&&"#no_message#"!==t?(o.html(t),a.fadeIn()):a.fadeOut(),e.hasOwnProperty("error_messages")){var n=-1;for(var s in e.error_messages){var c=i.has("[name='"+s+"']");c.addClass("has-error"),c.find("span").html(e.error_messages[s]);var u=c.position().top;(-1===n||n>u)&&(n=u)}$("html, body").css("scroll-top")>n&&$("html, body").animate({"scroll-top":n},"fast")}l(e)},error:function(e,t,n){o.html("提交申请遇到错误："+t+": "+n),a.fadeIn(),c(e,t,n)}})})})}function loadComplete(){$(".badge").each(function(){var a=$(this),e=a.data("source");"undefined"!=typeof e&&$.ajax({type:"GET",url:e,success:function(e){a.html(e.toString())}})})}function animate(a,e){a.removeClass().addClass("animated "+e).one("animationend",function(){$(this).removeClass("animated "+e)})}function showConfirmModal(a,e,t){var n='    <div class="modal fade" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="modal-label">        <div class="modal-dialog modal-sm" role="document">            <div class="modal-content">                <div class="modal-header">                    <h4 style="font-size: 19px;" class="modal-title" id="modal-label">                        <!-- title -->                    </h4>                </div>                <div class="modal-body" style="text-align: center;">                    <!-- message -->                </div>                <div class="modal-footer">                    <button id="modal-no-button" class="btn btn-danger" data-dismiss="modal">取消</button>                    <button id="modal-yes-button" class="btn btn-success" data-dismiss="modal">确认</button>                </div>            </div>        </div>    </div>';$("body").append(n);var o=$("#confirm-modal");o.find(".modal-header > h4").html(a),o.find(".modal-body").html(e),o.find("#modal-yes-button").click(t),o.on("hidden.bs.modal",function(){o.remove()}),o.modal(),resizeComponents(),loadComplete()}function showModal(a,e){$.ajax({type:"GET",url:a,success:function(a){$("body").append(a);var t=$("#"+e);t.on("hidden.bs.modal",function(){t.remove()}),t.modal(),resizeComponents(),loadComplete()},error:function(a,e,t){displayContent('                <div class="alert alert-danger" role="alert">                    <strong>部件载入出错。</strong>                    错误信息：'+e+": "+a.status+" "+t+a.responseText.replace(/\n/g,"<br>")+"</div>",{anim:!0,scroll:!0})}})}function callRepeated(a,e,t){var n=function(e){e>0&&(a(),setTimeout(function(){n(e-1)},t))};n(e)}function initLeftColumn(){var a=$("body"),e=$("#left-column"),t=$(".column-container");$("#left-column-toggle").click(function(t){if(t.preventDefault(),e.toggleClass("expanded"),e.hasClass("expanded")){var n=Math.max(a.height(),$(window).height()),o=$('<div id="left-column-backdrop" class="modal-backdrop fade visible-xs" style="z-index: 50; height: '+n+'px"></div>');a.append(o),setTimeout(function(){o.addClass("in")},100),$(o).click(function(){e.removeClass("expanded"),o.removeClass("in"),setTimeout(function(){o.remove()},500)})}else{var o=$("#left-column-backdrop");o.removeClass("in"),setTimeout(function(){o.remove()},500)}});var n="angle-double",o="fa-"+n+"-up",i="fa-"+n+"-down";e.find(".column-container > a").each(function(){$(this).append('<span class="fa '+o+' pull-right"></span>')}).click(function(){var a=$(this).find("span.fa"),e=$($(this).data("target"));setTimeout(function(){e.hasClass("in")?a.removeClass(i).addClass(o):a.removeClass(o).addClass(i)},500)}),e.ready(function(){var a=e.find(".scroll-edge-top"),n=a.find("span"),o=e.find(".scroll-edge-bottom"),i=o.find("span"),s=100;t.scroll(function(){var r=t.scrollTop(),l=t[0].scrollHeight,c=e.outerHeight(),d=s,u=s;r+s>l-c&&(d=l-c-r),s>r&&(u=r),i.css("opacity",d/s),n.css("opacity",u/s),0===d?o.stop(!0).fadeOut(150):o.stop(!0).fadeIn(150),0===u?a.stop(!0).fadeOut(150):a.stop(!0).fadeIn(150)}),a.css("opacity",""),o.css("opacity",""),a.fadeOut(0),o.fadeOut(0),t.scroll(),t.find("> a").click(function(){callRepeated(function(){$(window).scroll(),t.scroll()},40,10)}),a.click(function(){t.animate({"scroll-top":0},"fast")}),o.click(function(){t.animate({"scroll-top":t[0].scrollHeight-e.outerHeight()},"fast")})}),$(".left-column-item").click(function(){$(this).hasClass("active")||loadContentOfItem("#"+this.id)}),$(".fake-link-scroll").click(function(a){a.preventDefault(),$("html, body").animate({"scroll-top":0},"fast"),t.animate({"scroll-top":0},"fast")}),e.fixer({gap:removePx($(".main").css("padding-top"))})}function resizeComponents(){var a=$("#left-column"),e=a.outerHeight(!0);$("html, body").css("min-height",e),$("#main-page").css({"min-height":e}),$(".column-container").scroll();var t=$(".modal-backdrop");if("undefined"!=typeof t){var n=Math.max($("body").height(),$(window).height());t.height(n)}}function drawCharts(a){var e=$(".tab-content").data("loading"),t=$(".tab-pane > object");if("undefined"!=typeof t){var n=$(".tab-pane.active > object"),o=n.height(),i=n.width();t.each(function(){var a=$(this);a.ready(function(){var n=a.data("json");e!==!0&&""!==n&&(t.html(""),renderChart("#"+a.attr("id"),a.data("type"),a.data("json"),{width:i,height:o}))})})}}var csrftoken=getCookie("csrftoken");$(function(){$.ajaxSetup({beforeSend:function(a,e){csrfSafeMethod(e.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",csrftoken)}}),$(document).ajaxError(function(a,e,t,n){"403"==e.status&&(window.location="/login")})});var __manualStateChange=!1;$(function(){$(window).unbind("statechange"),History.Adapter.bind(window,"statechange",function(){var a=History.getState(),e=$("#main-page");if($(window).width()<768){$("#left-column").removeClass("expanded");var t=$("#left-column-backdrop");t.removeClass("in"),setTimeout(function(){t.remove()},500)}if(__manualStateChange)__manualStateChange=!1,displayContent(a.data.data,a.data.params,void 0,function(){"function"==typeof a.data.callback&&a.data.callback(),initAjaxPage("#main-page"),loadComplete()});else{if(e.stop(!0).animate({opacity:0,height:e.height()},250),$(".left-column-item").removeClass("active"),0!=a.data.item){var n=$(a.data.item);"undefined"!=typeof n&&$(n).addClass("active")}displayContent(a.data.data,{},void 0,function(){"function"==typeof a.data.callback&&a.data.callback(),initAjaxPage("#main-page"),loadComplete()})}}),$(window).on("resize",resizeComponents);var a;$(window).on("resize",function(e){clearTimeout(a),a=setTimeout(function(){drawCharts()},250)}),initLeftColumn(),initAjaxPage(),loadComplete()});
